#!/usr/bin/env node

/**
 * Module dependencies
 */
const async = require('async');
const generators = require('../lib/generators');
const program = require('commander');

var pkg = require('../package.json');
var version = pkg.version;

// CLI
program
    .version(version)
    .usage('[options]')
    .option('-ge, --generate <string>', 'name model', 'sampleMongo')
    .option('-del, --delete <string>', 'delete sample mongodb')
    .parse(process.argv)
    ;

// Main program
(function (path) {
    if(program.delete){
        deleteModel(path);
    }else{
        runGenerateG(path);
    }
    
})('.');

/**
 * Get parameters in interactive mode
 * @param {string} path destination path
 */
function runGenerateG(path) {
    var generate = program.generate;
    async.parallel([
        function (cb) {
            generators.generateModel(path, generate, cb);
        },
        function (cb) {
            generators.generateController(path, generate, cb);
        },
        function (cb) {
            generators.generateRoute(path, generate, cb);
        },
    ]);
}

function deleteModel(path){
    var modelName = program.delete;
    async.parallel([
        function (cb) {
            generators.deleteModel(path, modelName, cb);
        }
    ]);
}